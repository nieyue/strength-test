webpackJsonp([6],{"7qNE":function(e,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t={name:"RolePermission",data:function(){var e=this;return{role:{},permission:{},roleIsSuperAdmin:!1,params:{startNum:1,currentPage:1,pageNum:1,pageSize:1e8,total:0},regionList:[{id:1,value:"公共"},{id:2,value:"自身"}],typeList:[{id:1,value:"开放"},{id:2,value:"鉴权"}],regionParamsList:[{id:"",value:"全部"},{id:1,value:"公共"},{id:2,value:"自身"}],addRolePermissionModel:!1,addLoading:!1,addRolePermissionRules:{permissionId:[{type:"string",required:!0,message:"权限为必选项",trigger:"change"}],region:[{type:"number",required:!0,message:"范围为必选项",trigger:"change"}]},addRolePermission:{region:2},updateRolePermissionModel:!1,updateLoading:!1,updateRolePermissionRules:{region:[{type:"number",required:!0,message:"范围为必选项",trigger:"change"}]},updateRolePermission:{},deleteRolePermission:{},permissionList:[],rolePermissionList:[],rolePermissionColumns:[{title:"序号",minWidth:100,align:"center",render:function(s,i){return s("span",i.index+(e.params.currentPage-1)*e.params.pageSize+e.params.startNum)}},{title:"角色权限id",minWidth:100,key:"rolePermissionId",align:"center"},{title:"角色权限范围",minWidth:100,key:"region",align:"center",render:function(s,i){var t="";return e.regionList.forEach(function(e){e.id==i.row.region&&(t=e.value)}),s("span",t)}},{title:"角色权限类型",minWidth:100,key:"permission.type",align:"center",render:function(s,i){var t="";return e.typeList.forEach(function(e){e.id==i.row.permission.type&&(t=e.value)}),s("span",t)}},{title:"权限管理名",minWidth:100,align:"center",render:function(e,s){return e("span",s.row.permission.managerName)}},{title:"角色权限名",minWidth:100,align:"center",render:function(e,s){return e("span",s.row.permission.name)}},{title:"路由",minWidth:100,align:"center",render:function(e,s){return e("span",s.row.permission.route)}},{title:"修改时间",minWidth:100,key:"updateDate",sortable:!0,align:"center"},{title:"操作",minWidth:200,key:"action",align:"center",render:function(s,i){var t=s("Button",{props:{type:"primary",size:"small"},style:{marginLeft:"10px"},on:{click:function(){e.update(i.row)}}},"编辑"),r=s("Button",{props:{type:"error",size:"small"},style:{marginLeft:"10px"},on:{click:function(){e.delete(i.row)}}},"删除");s("div","");return s("div",[t,r])}}]}},methods:{addAllPublicPermission:function(){var e=this;this.$Spin.show();for(var s=this.permissionList.length,i=function(i){setTimeout(function(){e.addRolePermission.roleId=e.$route.params.roleId,e.addRolePermission.region=1,e.addRolePermission.permissionId=e.permissionList[i].permissionId,e.axios({method:"post",url:"/rolePermission/add",data:e.Qs.stringify(e.addRolePermission),withCredentials:!0}).then(function(t){200==t.data.code?i==s-1&&(e.$Message.success(t.data.msg),e.getList(),e.$Spin.hide()):e.$Message.error(t.data.msg)}).catch(function(s){e.$Message.error(s.data.msg)})},100*i)},t=0;t<s;t++)i(t)},addAllSelfPermission:function(){var e=this;this.$Spin.show();for(var s=this.permissionList.length,i=function(i){setTimeout(function(){e.addRolePermission.roleId=e.$route.params.roleId,e.addRolePermission.region=2,e.addRolePermission.permissionId=e.permissionList[i].permissionId,e.axios({method:"post",url:"/rolePermission/add",data:e.Qs.stringify(e.addRolePermission),withCredentials:!0}).then(function(t){200==t.data.code?i==s-1&&(e.$Message.success(t.data.msg),e.getList(),e.$Spin.hide()):e.$Message.error(t.data.msg)}).catch(function(s){e.$Message.error(s.data.msg)})},100*i)},t=0;t<s;t++)i(t)},delAllPermission:function(){var e=this;this.$Spin.show();for(var s=this.rolePermissionList.length,i=function(i){setTimeout(function(){e.axios({method:"post",url:"/rolePermission/delete?rolePermissionId="+e.rolePermissionList[i].rolePermissionId,withCredentials:!0}).then(function(t){200==t.data.code?i==s-1&&(e.$Message.success(t.data.msg),e.getList(),e.$Spin.hide(),location.reload()):e.$Message.error(t.data.msg)}).catch(function(s){e.$Message.error(s.data.msg)})},100*i)},t=0;t<s;t++)i(t)},search:function(){this.params.currentPage=1,this.params.pageNum=1,this.getList()},selectPage:function(e){this.params.currentPage=e,this.params.pageNum=(this.params.currentPage-1)*this.params.pageSize+this.params.startNum,this.getList()},getRoleByRoleId:function(){var e=this;this.axiosbusiness.get(this,{url:"/role/load?roleId="+this.$route.params.roleId,data:"role",success:function(){"超级管理员"==e.role.name?e.roleIsSuperAdmin=!0:e.getPermissionList()}})},getPermissionList:function(){var e=this;this.params.type=2,this.axiosbusiness.getList(this,{countUrl:"/permission/count",listUrl:"/permission/list",data:"permissionList",success:function(){e.getList()}},this.params)},getList:function(){var e=this;this.params.roleId=this.$route.params.roleId,this.axiosbusiness.getList(this,{countUrl:"/rolePermission/count",listUrl:"/rolePermission/list",data:"rolePermissionList",success:function(){for(var s=e.permissionList.length,i=0;i<s;i++)for(var t=0;t<e.rolePermissionList.length;t++)if(e.permissionList[i].permissionId==e.rolePermissionList[t].permissionId){e.permissionList.splice(i,1),s--,i--;break}}},this.params)},add:function(e){this.addRolePermissionModel=!0,this.addRolePermission.roleId=this.$route.params.roleId},addCancel:function(){this.addLoading||(this.addRolePermissionModel=!1,this.$refs.addRolePermission.resetFields())},addSure:function(){this.axiosbusiness.add(this,{ref:"addRolePermission",url:"/rolePermission/add",requestObject:"addRolePermission",loading:"addLoading",showModel:"addRolePermissionModel"})},update:function(e){this.updateRolePermissionModel=!0,this.addRolePermission.roleId=this.$route.params.roleId,this.axiosbusiness.get(this,{url:"/rolePermission/load?rolePermissionId="+e.rolePermissionId,data:"updateRolePermission"})},updateCancel:function(){this.updateLoading||(this.updateRolePermissionModel=!1,this.$refs.updateRolePermission.resetFields())},updateSure:function(){delete this.updateRolePermission.permission,this.axiosbusiness.update(this,{ref:"updateRolePermission",url:"/rolePermission/update",requestObject:"updateRolePermission",loading:"updateLoading",showModel:"updateRolePermissionModel"})},delete:function(e){var s=this;this.deleteRolePermission={rolePermissionId:e.rolePermissionId},this.axiosbusiness.delete(this,{url:"/rolePermission/delete",requestObject:"deleteRolePermission",success:function(){s.axiosbusiness.get(s,{url:"/permission/load?permissionId="+e.permissionId,data:"permission",success:function(){s.permissionList.push(s.permission),s.getList()}})}})}},created:function(){this.getRoleByRoleId()},mounted:function(){}},r={render:function(){var e=this,s=e.$createElement,i=e._self._c||s;return i("div",{staticClass:"body-wrap"},[e.roleIsSuperAdmin?i("div",[i("Alert",{staticStyle:{"text-align":"center"},attrs:{type:"success"}},[e._v("\n      拥有所有权限\n      ")])],1):e.roleIsSuperAdmin?e._e():i("div",[i("Alert",{attrs:{type:"success"}},[i("p",[e._v("范围:")]),e._v(" "),i("p",[e._v("公共,（代表拥有此权限的人可以访问此接口的数据，包含非自身，即是其他账户接口的数据）")]),e._v(" "),i("p",[e._v("自身,（代表拥有此权限的人可以访问此接口的数据，自能是自身账户接口的数据）")])]),e._v(" "),i("div",{staticClass:"body-btn-wrap"},[i("Button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("增加角色权限")]),e._v(" "),i("Button",{attrs:{type:"warning"},on:{click:e.addAllPublicPermission}},[e._v("一键添加所有公共权限")]),e._v(" "),i("Button",{attrs:{type:"info"},on:{click:e.addAllSelfPermission}},[e._v("一键添加所有自身权限")]),e._v(" "),i("Button",{attrs:{type:"error"},on:{click:e.delAllPermission}},[e._v("一键删除所有权限")]),e._v(" "),i("div",{staticClass:"search-wrap"},[i("Select",{staticClass:"search-wrap-input",attrs:{transfer:"",placeholder:"范围，全部"},model:{value:e.params.region,callback:function(s){e.$set(e.params,"region",s)},expression:"params.region"}},e._l(e.regionParamsList,function(s){return i("Option",{key:s.id,attrs:{value:s.id}},[e._v(e._s(s.value))])})),e._v(" "),i("Input",{staticClass:"search-wrap-input",attrs:{placeholder:"权限id"},model:{value:e.params.permissionId,callback:function(s){e.$set(e.params,"permissionId",s)},expression:"params.permissionId"}}),e._v(" "),i("Button",{attrs:{type:"info"},on:{click:e.search}},[e._v("查询")])],1)],1),e._v(" "),i("Modal",{attrs:{title:"新增角色权限管理",closable:!1,"mask-closable":!1,width:"800px"},model:{value:e.addRolePermissionModel,callback:function(s){e.addRolePermissionModel=s},expression:"addRolePermissionModel"}},[i("Form",{ref:"addRolePermission",attrs:{model:e.addRolePermission,"label-width":100,"label-position":"right",rules:e.addRolePermissionRules}},[i("FormItem",{attrs:{prop:"permissionId",label:"权限:"}},[i("RadioGroup",{attrs:{type:"button"},model:{value:e.addRolePermission.permissionId,callback:function(s){e.$set(e.addRolePermission,"permissionId",s)},expression:"addRolePermission.permissionId"}},e._l(e.permissionList,function(s){return i("Radio",{key:s.permissionId,staticStyle:{margin:"5px","border-left":"1px solid #dddee1"},attrs:{label:s.permissionId,value:s.permissionId}},[e._v("\n                "+e._s(s.name)+"\n            ")])}))],1),e._v(" "),i("FormItem",{attrs:{prop:"region",label:"范围:"}},[i("Select",{staticStyle:{width:"100px"},attrs:{transfer:"",size:"large"},model:{value:e.addRolePermission.region,callback:function(s){e.$set(e.addRolePermission,"region",s)},expression:"addRolePermission.region"}},e._l(e.regionList,function(s){return i("Option",{key:s.id,attrs:{value:s.id}},[e._v(e._s(s.value))])}))],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:e.addCancel}},[e._v("取消")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.addLoading}},[e.addLoading?i("span",[e._v("Loading...")]):i("span",{on:{click:e.addSure}},[e._v("确定")])])],1)],1),e._v(" "),i("Modal",{attrs:{title:"修改角色权限管理",closable:!1,"mask-closable":!1},model:{value:e.updateRolePermissionModel,callback:function(s){e.updateRolePermissionModel=s},expression:"updateRolePermissionModel"}},[i("Form",{ref:"updateRolePermission",attrs:{model:e.updateRolePermission,"label-width":100,"label-position":"right",rules:e.updateRolePermissionRules}},[i("FormItem",{attrs:{prop:"permissionId",label:"权限:"}},e._l(e.updateRolePermission.permission,function(s,t){return"name"==t?i("span",{key:t,attrs:{value:s},domProps:{textContent:e._s(s)}}):e._e()})),e._v(" "),i("FormItem",{attrs:{prop:"region",label:"范围:"}},[i("Select",{staticStyle:{width:"100px"},attrs:{transfer:"",size:"large"},model:{value:e.updateRolePermission.region,callback:function(s){e.$set(e.updateRolePermission,"region",s)},expression:"updateRolePermission.region"}},e._l(e.regionList,function(s){return i("Option",{key:s.id,attrs:{value:s.id}},[e._v(e._s(s.value))])}))],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{on:{click:e.updateCancel}},[e._v("取消")]),e._v(" "),i("Button",{attrs:{type:"primary",loading:e.updateLoading}},[e.updateLoading?i("span",[e._v("Loading...")]):i("span",{on:{click:e.updateSure}},[e._v("确定")])])],1)],1),e._v(" "),i("Table",{ref:"table",attrs:{border:"",height:"500",current:e.params.currentPage,columns:e.rolePermissionColumns,data:e.rolePermissionList,size:"small"}})],1)])},staticRenderFns:[]},o=i("VU/8")(t,r,!1,null,null,null);s.default=o.exports}});
//# sourceMappingURL=6.f88d45e3a9f009da6c14.js.map